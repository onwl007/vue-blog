<template>
  <div class="app">
    <AppBackground/>
    <AppHeader/>
    <main class="app-main" :style="mainStyle">
      <div class="container">
        <nuxt class="page-main-widget"/>
        <transition name="fade" mode="out-in">
          <AppAside class="page-aside-widget" v-if="!noAsidePage"/>
        </transition>
      </div>
    </main>
    <AppTool/>
    <AppFooter ref="footer"/>
  </div>
</template>

<script>
  import {
    AppHeader,
    AppBackground,
    AppFooter,
    AppAside,
    AppTool
  } from "../components/layout";

  export default {
    name: 'Default',
    components: {
      AppTool,
      AppAside,
      AppFooter,
      AppBackground,
      AppHeader
    },
    head() {
      return {
        htmlAttrs: {
          class: 'pc'
        }
      }
    },
    data() {
      return {
        mainStyle: null
      }
    },
    computed: {
      noAsidePage() {
        return ['music', 'archive', 'guestbook', 'about'].includes(this.$router.name)
      }
    },
    mounted() {
      this.mainStyle = {
        minHeight: `calc(100vh-${this.$refs.footer.$el.clientHeight}px)`
      }
    }
  }

</script>

<style lang="stylus">
  @import '~@/assets/stylus/var/index'
  @import '~@/assets/stylus/mixin/index'

  .app{
    min-width $main-width

    &-main{
      width $main-width
      border-top $header-height solid transparent
      margin 0 auto
      padding 20px 0 80px

      .container{
        flexLayout(,flex-start,flex-start)

        .page-main-widget{
          flex 1 0
        }

        .page-aside-widget{
          flex 1 0 0 320px
          width 320px
          margin-left 12px
        }
      }
    }
  }

  body.full-page{
    .app-main{
      width 100%
      padding 0 0 80px
    }
  }
</style>
